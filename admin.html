<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Melbourne Lawn Care - Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBewthZtqSGpLsrP4sRBkBkM6fYvvr1T4E",
      authDomain: "lawncare-crm-b3617.firebaseapp.com",
      projectId: "lawncare-crm-b3617",
      storageBucket: "lawncare-crm-b3617.appspot.com",
      messagingSenderId: "208959921459",
      appId: "1:208959921459:web:5161477d1943f96c7c8246",
      measurementId: "G-7VG6PHM0N1"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <style>
    body { font-family: 'Roboto', sans-serif; background: #f5f5f5; margin: 0; }
    header { background: #2e7d32; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; }
    .btn { background: #2e7d32; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
    .btn-danger { background: #d32f2f; }
    .container { max-width: 1000px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
    h2 { color: #2e7d32; }
    .customer-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; }
    .customer-card h3 { margin: 0 0 10px; }
  </style>
</head>
<body>
  <header>
    <h1>Admin Panel</h1>
    <div>
      <span id="current-user"></span>
      <button class="btn btn-danger" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="container">
    <h2>Dashboard</h2>
    <p>Total Customers: <span id="total-customers">0</span></p>
    <p>Total Services: <span id="total-services">0</span></p>
    <hr>

    <h2>Add Customer</h2>
    <form id="customer-form">
      <input type="text" id="name" placeholder="Full Name" required><br><br>
      <input type="email" id="email" placeholder="Email" required><br><br>
      <input type="text" id="phone" placeholder="Phone" required><br><br>
      <input type="text" id="address" placeholder="Address" required><br><br>
      <button type="submit" class="btn">Save Customer</button>
    </form>
    <hr>

    <h2>Customer List</h2>
    <div id="customers-list"></div>
  </div>

  <script>
    // Auth kontrolÃ¼
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        document.getElementById("current-user").textContent = user.email;
        loadCustomers();
        loadStats();
      }
    });

    // Logout
    function logout() {
      auth.signOut();
    }

    // Customer ekleme
    document.getElementById("customer-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const phone = document.getElementById("phone").value;
      const address = document.getElementById("address").value;

      await db.collection("musteriler").add({
        name, email, phone, address,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById("customer-form").reset();
      loadCustomers();
      loadStats();
    });

    // Customer listeleme
    async function loadCustomers() {
      const snapshot = await db.collection("musteriler").orderBy("createdAt", "desc").get();
      const container = document.getElementById("customers-list");
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "customer-card";
        div.innerHTML = `
          <h3>${data.name}</h3>
          <p>Email: ${data.email}</p>
          <p>Phone: ${data.phone}</p>
          <p>Address: ${data.address}</p>
        `;
        container.appendChild(div);
      });
    }

    // Dashboard stats
    async function loadStats() {
      const customers = await db.collection("musteriler").get();
      document.getElementById("total-customers").textContent = customers.size;

      const services = await db.collection("hizmetler").get();
      document.getElementById("total-services").textContent = services.size;
    }
  </script>
</body>
</html>
